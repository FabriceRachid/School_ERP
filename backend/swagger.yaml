openapi: 3.0.0
info:
  title: School ERP API
  description: Multi-School Management System API
  version: 1.0.0
  contact:
    name: School ERP Team
    email: support@schoolerp.com

servers:
  - url: http://localhost:3001/api
    description: Development server

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    # Authentication schemas
    LoginRequest:
      type: object
      required:
        - email
        - password
      properties:
        email:
          type: string
          format: email
          example: "john.doe@example.com"
        password:
          type: string
          example: "Password123!"

    LoginResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        message:
          type: string
          example: "Login successful"
        data:
          type: object
          properties:
            user:
              $ref: '#/components/schemas/User'
            accessToken:
              type: string
              example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
            refreshToken:
              type: string
              example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."

    # User schemas
    User:
      type: object
      properties:
        id:
          type: string
          format: uuid
          example: "123e4567-e89b-12d3-a456-426614174000"
        school_id:
          type: string
          format: uuid
          example: "123e4567-e89b-12d3-a456-426614174000"
        first_name:
          type: string
          example: "John"
        last_name:
          type: string
          example: "Doe"
        email:
          type: string
          format: email
          example: "john.doe@example.com"
        role:
          type: string
          enum: [admin, teacher, student]
          example: "teacher"
        status:
          type: string
          enum: [active, suspended, disabled]
          example: "active"
        phone:
          type: string
          example: "+1234567890"
        address:
          type: string
          example: "123 Main Street"
        date_of_birth:
          type: string
          format: date
          example: "1990-01-01"
        created_at:
          type: string
          format: date-time
          example: "2023-01-01T00:00:00Z"
        updated_at:
          type: string
          format: date-time
          example: "2023-01-01T00:00:00Z"

    # School schemas
    School:
      type: object
      properties:
        id:
          type: string
          format: uuid
          example: "123e4567-e89b-12d3-a456-426614174000"
        name:
          type: string
          example: "Greenwood High School"
        address:
          type: string
          example: "456 Education Avenue"
        phone:
          type: string
          example: "+1234567890"
        email:
          type: string
          format: email
          example: "info@greenwood.edu"
        created_at:
          type: string
          format: date-time
          example: "2023-01-01T00:00:00Z"
        updated_at:
          type: string
          format: date-time
          example: "2023-01-01T00:00:00Z"

    # Student schemas
    Student:
      type: object
      properties:
        id:
          type: string
          format: uuid
          example: "123e4567-e89b-12d3-a456-426614174000"
        user_id:
          type: string
          format: uuid
          example: "123e4567-e89b-12d3-a456-426614174000"
        class_id:
          type: string
          format: uuid
          example: "123e4567-e89b-12d3-a456-426614174000"
        student_id:
          type: string
          example: "STU001"
        parent_name:
          type: string
          example: "Jane Doe"
        parent_phone:
          type: string
          example: "+1234567890"
        enrollment_date:
          type: string
          format: date
          example: "2023-09-01"
        created_at:
          type: string
          format: date-time
          example: "2023-01-01T00:00:00Z"
        updated_at:
          type: string
          format: date-time
          example: "2023-01-01T00:00:00Z"

    # Teacher schemas
    Teacher:
      type: object
      properties:
        id:
          type: string
          format: uuid
          example: "123e4567-e89b-12d3-a456-426614174000"
        user_id:
          type: string
          format: uuid
          example: "123e4567-e89b-12d3-a456-426614174000"
        specialization:
          type: string
          example: "Mathematics"
        hire_date:
          type: string
          format: date
          example: "2020-09-01"
        salary:
          type: number
          format: decimal
          example: 50000.00
        created_at:
          type: string
          format: date-time
          example: "2023-01-01T00:00:00Z"
        updated_at:
          type: string
          format: date-time
          example: "2023-01-01T00:00:00Z"

    # Class schemas
    Class:
      type: object
      properties:
        id:
          type: string
          format: uuid
          example: "123e4567-e89b-12d3-a456-426614174000"
        school_id:
          type: string
          format: uuid
          example: "123e4567-e89b-12d3-a456-426614174000"
        name:
          type: string
          example: "Grade 10A"
        academic_year:
          type: string
          example: "2023-2024"
        level:
          type: string
          example: "Secondary"
        created_at:
          type: string
          format: date-time
          example: "2023-01-01T00:00:00Z"
        updated_at:
          type: string
          format: date-time
          example: "2023-01-01T00:00:00Z"

    # Subject schemas
    Subject:
      type: object
      properties:
        id:
          type: string
          format: uuid
          example: "123e4567-e89b-12d3-a456-426614174000"
        school_id:
          type: string
          format: uuid
          example: "123e4567-e89b-12d3-a456-426614174000"
        name:
          type: string
          example: "Mathematics"
        code:
          type: string
          example: "MATH101"
        coefficient:
          type: number
          format: decimal
          example: 1.5
        created_at:
          type: string
          format: date-time
          example: "2023-01-01T00:00:00Z"
        updated_at:
          type: string
          format: date-time
          example: "2023-01-01T00:00:00Z"

    # Grade schemas
    Grade:
      type: object
      properties:
        id:
          type: string
          format: uuid
          example: "123e4567-e89b-12d3-a456-426614174000"
        student_id:
          type: string
          format: uuid
          example: "123e4567-e89b-12d3-a456-426614174000"
        subject_id:
          type: string
          format: uuid
          example: "123e4567-e89b-12d3-a456-426614174000"
        teacher_id:
          type: string
          format: uuid
          example: "123e4567-e89b-12d3-a456-426614174000"
        evaluation_type:
          type: string
          example: "Midterm Exam"
        score:
          type: number
          format: decimal
          example: 18.5
        max_score:
          type: number
          format: decimal
          example: 20.0
        academic_year:
          type: string
          example: "2023-2024"
        semester:
          type: string
          example: "First Semester"
        date:
          type: string
          format: date
          example: "2023-10-15"
        comments:
          type: string
          example: "Excellent work on problem solving"
        created_at:
          type: string
          format: date-time
          example: "2023-01-01T00:00:00Z"
        updated_at:
          type: string
          format: date-time
          example: "2023-01-01T00:00:00Z"

    # Payment schemas
    Payment:
      type: object
      properties:
        id:
          type: string
          format: uuid
          example: "123e4567-e89b-12d3-a456-426614174000"
        student_id:
          type: string
          format: uuid
          example: "123e4567-e89b-12d3-a456-426614174000"
        fee_id:
          type: string
          format: uuid
          example: "123e4567-e89b-12d3-a456-426614174000"
        amount:
          type: number
          format: decimal
          example: 500.00
        payment_date:
          type: string
          format: date
          example: "2023-09-15"
        payment_method:
          type: string
          example: "Credit Card"
        reference_number:
          type: string
          example: "PAY123456"
        status:
          type: string
          enum: [pending, completed, failed, refunded]
          example: "completed"
        created_at:
          type: string
          format: date-time
          example: "2023-01-01T00:00:00Z"
        updated_at:
          type: string
          format: date-time
          example: "2023-01-01T00:00:00Z"

    # Notification schemas
    Notification:
      type: object
      properties:
        id:
          type: string
          format: uuid
          example: "123e4567-e89b-12d3-a456-426614174000"
        sender_id:
          type: string
          format: uuid
          example: "123e4567-e89b-12d3-a456-426614174000"
        recipient_id:
          type: string
          format: uuid
          example: "123e4567-e89b-12d3-a456-426614174000"
        title:
          type: string
          example: "Welcome to School ERP"
        message:
          type: string
          example: "Welcome to our school management system"
        type:
          type: string
          example: "welcome"
        status:
          type: string
          enum: [read, unread, archived]
          example: "unread"
        created_at:
          type: string
          format: date-time
          example: "2023-01-01T00:00:00Z"
        read_at:
          type: string
          format: date-time
          example: "2023-01-01T00:00:00Z"

    # Error response schema
    ErrorResponse:
      type: object
      properties:
        success:
          type: boolean
          example: false
        message:
          type: string
          example: "Error description"
        error:
          type: string
          example: "Detailed error message"

    # Success response schema
    SuccessResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        message:
          type: string
          example: "Operation completed successfully"
        data:
          type: object
        count:
          type: integer
          example: 10

paths:
  /auth/login:
    post:
      summary: User login
      description: Authenticate user and get access token
      tags: [Authentication]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoginResponse'
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Invalid credentials
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /auth/register:
    post:
      summary: Register new user
      description: Create a new user account
      tags: [Authentication]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - school_id
                - first_name
                - last_name
                - email
                - password
                - role
              properties:
                school_id:
                  type: string
                  format: uuid
                first_name:
                  type: string
                last_name:
                  type: string
                email:
                  type: string
                  format: email
                password:
                  type: string
                role:
                  type: string
                  enum: [admin, teacher, student]
                phone:
                  type: string
                address:
                  type: string
                date_of_birth:
                  type: string
                  format: date
      responses:
        '201':
          description: User registered successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '409':
          description: Email already registered
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /schools:
    get:
      summary: Get all schools
      description: Retrieve all schools
      tags: [Schools]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Schools retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    post:
      summary: Create new school
      description: Create a new school
      tags: [Schools]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
              properties:
                name:
                  type: string
                address:
                  type: string
                phone:
                  type: string
                email:
                  type: string
                  format: email
      responses:
        '201':
          description: School created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /users:
    get:
      summary: Get all users
      description: Retrieve all users in the school
      tags: [Users]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Users retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    post:
      summary: Create new user
      description: Create a new user (admin only)
      tags: [Users]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - school_id
                - first_name
                - last_name
                - email
                - password
                - role
              properties:
                school_id:
                  type: string
                  format: uuid
                first_name:
                  type: string
                last_name:
                  type: string
                email:
                  type: string
                  format: email
                password:
                  type: string
                role:
                  type: string
                  enum: [admin, teacher, student]
                phone:
                  type: string
                address:
                  type: string
                date_of_birth:
                  type: string
                  format: date
      responses:
        '201':
          description: User created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Insufficient permissions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /students:
    get:
      summary: Get all students
      description: Retrieve all students in the school
      tags: [Students]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Students retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    post:
      summary: Create new student
      description: Create a new student record
      tags: [Students]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - user_id
                - student_id
              properties:
                user_id:
                  type: string
                  format: uuid
                class_id:
                  type: string
                  format: uuid
                student_id:
                  type: string
                parent_name:
                  type: string
                parent_phone:
                  type: string
                enrollment_date:
                  type: string
                  format: date
      responses:
        '201':
          description: Student created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Insufficient permissions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /teachers:
    get:
      summary: Get all teachers
      description: Retrieve all teachers in the school
      tags: [Teachers]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Teachers retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    post:
      summary: Create new teacher
      description: Create a new teacher record
      tags: [Teachers]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - user_id
              properties:
                user_id:
                  type: string
                  format: uuid
                specialization:
                  type: string
                hire_date:
                  type: string
                  format: date
                salary:
                  type: number
                  format: decimal
      responses:
        '201':
          description: Teacher created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Insufficient permissions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /classes:
    get:
      summary: Get all classes
      description: Retrieve all classes in the school
      tags: [Classes]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Classes retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    post:
      summary: Create new class
      description: Create a new class
      tags: [Classes]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
                - academic_year
              properties:
                name:
                  type: string
                academic_year:
                  type: string
                level:
                  type: string
      responses:
        '201':
          description: Class created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Insufficient permissions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /subjects:
    get:
      summary: Get all subjects
      description: Retrieve all subjects in the school
      tags: [Subjects]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Subjects retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    post:
      summary: Create new subject
      description: Create a new subject
      tags: [Subjects]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
              properties:
                name:
                  type: string
                code:
                  type: string
                coefficient:
                  type: number
                  format: decimal
      responses:
        '201':
          description: Subject created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Insufficient permissions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /grades:
    post:
      summary: Create new grade
      description: Record a new grade
      tags: [Grades]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - student_id
                - subject_id
                - evaluation_type
                - score
                - academic_year
                - semester
                - date
              properties:
                student_id:
                  type: string
                  format: uuid
                subject_id:
                  type: string
                  format: uuid
                evaluation_type:
                  type: string
                score:
                  type: number
                  format: decimal
                max_score:
                  type: number
                  format: decimal
                academic_year:
                  type: string
                semester:
                  type: string
                date:
                  type: string
                  format: date
                comments:
                  type: string
      responses:
        '201':
          description: Grade created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Insufficient permissions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /payments:
    post:
      summary: Create new payment
      description: Record a new payment
      tags: [Payments]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - student_id
                - fee_id
                - amount
                - payment_date
              properties:
                student_id:
                  type: string
                  format: uuid
                fee_id:
                  type: string
                  format: uuid
                amount:
                  type: number
                  format: decimal
                payment_date:
                  type: string
                  format: date
                payment_method:
                  type: string
                reference_number:
                  type: string
                status:
                  type: string
                  enum: [pending, completed, failed, refunded]
      responses:
        '201':
          description: Payment created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Insufficient permissions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /notifications:
    get:
      summary: Get user notifications
      description: Retrieve notifications for the current user
      tags: [Notifications]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Notifications retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    post:
      summary: Create new notification
      description: Send a new notification
      tags: [Notifications]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - recipient_id
                - title
                - message
                - type
              properties:
                recipient_id:
                  type: string
                  format: uuid
                title:
                  type: string
                message:
                  type: string
                type:
                  type: string
      responses:
        '201':
          description: Notification created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Insufficient permissions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'